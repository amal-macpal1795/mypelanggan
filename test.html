<!doctype html>
<html>
<head><meta charset="utf-8"><title>Test Firestore</title></head>
<body>
  <h3>Test Firestore - buka Console</h3>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "API_KEY_YANG_TEPAT",
      authDomain: "mypelanggan.firebaseapp.com",
      projectId: "mypelanggan",
      storageBucket: "mypelanggan.appspot.com",
      messagingSenderId: "1087396305114",
      appId: "1:1087396305114:web:c6302f37a3b84590726de3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // *** Opsional: login pake akun yang sudah ada supaya request.auth != null utk rules ***
    async function quickTest() {
      try {
        // 1) Login (pakai akun yang sudah kamu buat lewat daftar.html)
        const email = "akun_test@domain.local"; // ganti dengan akun yang valid
        const password = "password_test";        // ganti sesuai
        await signInWithEmailAndPassword(auth, email, password);
        console.log("Auth: logged in", auth.currentUser.uid);

        // 2) Tulis test document ke users/{uid}/tests/testDoc
        const uid = auth.currentUser.uid;
        const testRef = doc(db, "users", uid, "tests", "connectionCheck");
        await setDoc(testRef, { ok: true, t: new Date().toISOString() });
        console.log("Firestore: write OK");

        // 3) Baca kembali doc
        const snap = await getDoc(testRef);
        console.log("Firestore: read OK ->", snap.data());
      } catch (err) {
        console.error("TEST ERROR:", err);
      }
    }

    quickTest();
  </script>
</body>
</html>
